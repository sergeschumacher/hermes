{
  "name": "RecoStream -> Telegram",
  "nodes": [
    {
      "parameters": {
        "path": "webhooks/recostream",
        "method": "POST",
        "responseMode": "onReceived",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{$json.body.event}}",
        "rules": [
          { "operation": "equal", "value2": "request_created" },
          { "operation": "equal", "value2": "request_approved" },
          { "operation": "equal", "value2": "download_complete" },
          { "operation": "equal", "value2": "recording_finished" }
        ]
      },
      "name": "Switch Event",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "message",
              "value": "={{$json.body.media_type === 'series' ? ('Download complete: ' + ($json.body.series_name || $json.body.title || 'Unknown') + ' S' + String($json.body.season || '').padStart(2,'0') + 'E' + String($json.body.episode || '').padStart(2,'0') + ( $json.body.title ? ' - ' + $json.body.title : '' )) : ('Download complete: ' + ($json.body.title || 'Unknown'))}}"
            }
          ]
        }
      },
      "name": "Format Download Message",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [700, 360]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "message",
              "value": "={{'Recording finished: ' + ($json.body.title || 'Unknown')}}"
            }
          ]
        }
      },
      "name": "Format Recording Message",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [700, 520]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "message",
              "value": "={{$json.body.media_type === 'series' ? ('New series request: ' + ($json.body.series_name || $json.body.title || 'Unknown') + ' S' + String($json.body.season || '').padStart(2,'0') + 'E' + String($json.body.episode || '').padStart(2,'0') + ( $json.body.title ? ' - ' + $json.body.title : '' ) + ( $json.body.requested_by ? ' (by ' + $json.body.requested_by + ')' : '' )) : ('New movie request: ' + ($json.body.title || 'Unknown') + ( $json.body.requested_by ? ' (by ' + $json.body.requested_by + ')' : '' ))}}"
            }
          ]
        }
      },
      "name": "Format Request Created",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [700, 80]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "message",
              "value": "={{$json.body.media_type === 'series' ? ('Request approved: ' + ($json.body.series_name || $json.body.title || 'Unknown') + ' S' + String($json.body.season || '').padStart(2,'0') + 'E' + String($json.body.episode || '').padStart(2,'0') + ( $json.body.title ? ' - ' + $json.body.title : '' ) + ( $json.body.approved_by ? ' (by ' + $json.body.approved_by + ')' : '' )) : ('Request approved: ' + ($json.body.title || 'Unknown') + ( $json.body.approved_by ? ' (by ' + $json.body.approved_by + ')' : '' ))}}"
            }
          ]
        }
      },
      "name": "Format Request Approved",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [700, 220]
    },
    {
      "parameters": {
        "chatId": "TELEGRAM_CHAT_ID",
        "text": "={{$json.message}}"
      },
      "name": "Send Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [940, 300],
      "credentials": {
        "telegramApi": {
          "token": "TELEGRAM_BOT_TOKEN"
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "Switch Event", "type": "main", "index": 0 }]]
    },
    "Switch Event": {
      "main": [
        [{ "node": "Format Request Created", "type": "main", "index": 0 }],
        [{ "node": "Format Request Approved", "type": "main", "index": 0 }],
        [{ "node": "Format Download Message", "type": "main", "index": 0 }],
        [{ "node": "Format Recording Message", "type": "main", "index": 0 }],
        []
      ]
    },
    "Format Request Created": {
      "main": [[{ "node": "Send Telegram", "type": "main", "index": 0 }]]
    },
    "Format Request Approved": {
      "main": [[{ "node": "Send Telegram", "type": "main", "index": 0 }]]
    },
    "Format Download Message": {
      "main": [[{ "node": "Send Telegram", "type": "main", "index": 0 }]]
    },
    "Format Recording Message": {
      "main": [[{ "node": "Send Telegram", "type": "main", "index": 0 }]]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "1"
}
